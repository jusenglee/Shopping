<!DOCTYPE html>
<html layout:decorate="~{layouts/default}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Thymeleaf Example</title>
</head>
<body>
<th:block layout:fragment="script">

    <script th:inline="javascript">
        $(document).ready(function(){
            var errorMessage = [[${errorMessage}]];
            if(errorMessage != null){
                alert(errorMessage);
            }

            bindDomEvent();

        });

        function bindDomEvent(){
            $(".custom-file-input").on("change", function() {
                var fileName = $(this).val().split("\\").pop();  //이미지 파일명
                var fileExt = fileName.substring(fileName.lastIndexOf(".") + 1); // 확장자 추출
                fileExt = fileExt.toLowerCase(); //소문자 변환

                if (fileExt != "jpg" && fileExt != "jpeg" && fileExt != "gif" && fileExt != "png" && fileExt != "bmp") {
                    alert("이미지 파일만 등록이 가능합니다.");
                    return;
                }

                $(this).siblings(".custom-file-label").html(fileName);
            });
        }

    </script>
</th:block>

<div layout:fragment="content">
    <!-- Product section-->
    <section class="py-5">
        <div class="container px-4 px-lg-5 my-5">
            <div class="row gx-4 gx-lg-5 align-items-center">
                <!--<div class="col-md-7 col-lg-8 container">-->
                <form enctype="multipart/form-data" method="post" role="form" th:action="@{/admin/manage/item/new}"
                      th:object="${itemFormDto}">
                     <div class="row g-3">
                        <hr/>
                        <div class="col-12">
                            <label class="form-label" th:field="*{itemSellStatus}">상품 상태</label><br/>
                            <input id="SELL" name="itemSellStatus" type="radio" value="SELL">판매중<br/>
                            <input id="SOLD_OUT" name="itemSellStatus" type="radio" value="SOLD_OUT">품절<br/>
                            <div class="invalid-feedback">
                                Input is empty.
                            </div>
                        </div>
                         <div class="col-12">
                             <label class="form-label" th:field="*{category}">카테고리 상태</label><br/>
                             <input id="1" name="category" type="radio" value="1">바지<br/>
                             <input id="2" name="category" type="radio" value="2">상의<br/>
                             <div class="invalid-feedback">
                                 Input is empty.
                             </div>
                         </div>
                         <input th:field="*{id}" type="hidden">
                        <div class="col-12">
                            <label class="form-label">상품명</label>
                            <input class="form-control" placeholder="상품명을 입력해주세요" th:field="*{itemNm}" type="text">

                            <div class="invalid-feedback">
                                Your name is required.
                            </div>
                            <p class="fieldError" th:errors="*{itemNm}" th:if="${#fields.hasErrors('itemNm')}">Incorrect data</p>

                        </div>

                        <div class="col-12">
                            <label  class="form-label">상품 설명</label>
                            <input class="form-control" id="itemDetail" name="itemDetail" placeholder="상품 설명을 입력하세요." th:field="*{itemDetail}" type="text">
                            <div class="invalid-feedback">
                                Input is empty.
                            </div>
                        </div>

                        <div class="col-12">
                            <label class="form-label">상품 가격</label>
                            <input class="form-control" id="price" name="price" placeholder="상품 가격을 입력하세요." th:field="*{price}" type="text">
                            <div class="invalid-feedback">
                                Input is empty.
                            </div>
                        </div>

                        <div class="col-12">
                            <label class="form-label">상품 재고</label>
                            <input class="form-control" id="stock" name="stock" placeholder="상품 재고를 입력하세요." th:field="*{stock}"
                                   type="text">
                            <div class="invalid-feedback">
                                Input is empty.
                            </div>
                        </div>

                         <div th:if="${#lists.isEmpty(itemImgDtoList)}">
                             <div class="form-group" th:each="num: ${#numbers.sequence(1,5)}">
                                 <div class="custom-file img-div">
                                     <input class="custom-file-input" name="itemImgFile" type="file">
                                     <label class="custom-file-label" th:text="상품이미지 + ${num}"></label>
                                 </div>
                             </div>
                         </div>

                         <div th:if = "${not #lists.isEmpty(itemImgDtoList)}">
                             <div class="form-group" th:each="itemImgDto, status: ${itemImgDtoList}">
                                 <div class="custom-file img-div">
                                     <input class="custom-file-input" name="itemImgFile" type="file">
                                     <input name="itemImgIds" th:value="${itemImgDto.id}" type="hidden">
                                     <label class="custom-file-label" th:text="${not #strings.isEmpty(itemImgDto.oriImgName)} ? ${itemImgDto.oriImgName} : '상품이미지' + ${status.index+1}"></label>
                                 </div>
                             </div>
                         </div>

                    </div>
                    <hr class="my-4">
                    <div style="text-align: center" th:if="${#strings.isEmpty(id)}">
                    <button class="w-100 btn btn-primary btn-lg mb-3" type="submit">상품 등록</button>
                    </div>
                    <input th:name="${_csrf.parameterName}" th:value="${_csrf.token}" type="hidden">

                </form>
            </div>
        </div>
    </section>
</div>
</body>
</html>